---
---
<div class="pipeline-diagram">
  <!-- Phase 1 -->
  <div class="pipeline-phase">
    <div class="pipeline-phase-header phase-collect">
      <span class="pipeline-phase-number">1</span>
      <span class="pipeline-phase-title">Collection</span>
      <span class="pipeline-phase-tag">Parallel ¬∑ async</span>
    </div>
    <div class="pipeline-phase-body">
      <div class="pipeline-nodes-grid">
        <div class="pipeline-node pn-source">
          <span class="pn-icon">üî•</span>
          <span class="pn-label">Prometheus</span>
          <span class="pn-detail">8 concurrent PromQL queries</span>
        </div>
        <div class="pipeline-node pn-source">
          <span class="pn-icon">‚ò∏Ô∏è</span>
          <span class="pn-label">Kubernetes API</span>
          <span class="pn-detail">Nodes, Pods, HPAs</span>
        </div>
        <div class="pipeline-node pn-source">
          <span class="pn-icon">üí≤</span>
          <span class="pn-label">OpenCost</span>
          <span class="pn-detail">Cost allocation</span>
        </div>
        <div class="pipeline-node pn-source">
          <span class="pn-icon">‚ö°</span>
          <span class="pn-label">Electricity Maps</span>
          <span class="pn-detail">gCO‚ÇÇ/kWh per zone</span>
        </div>
      </div>
    </div>
  </div>

  <div class="pipeline-arrow-down">
    <svg width="24" height="32" viewBox="0 0 24 32">
      <line x1="12" y1="0" x2="12" y2="24" stroke="var(--sl-color-gray-4)" stroke-width="2"/>
      <polygon points="6,24 18,24 12,32" fill="var(--sl-color-accent)"/>
    </svg>
  </div>

  <!-- Phase 2 -->
  <div class="pipeline-phase">
    <div class="pipeline-phase-header phase-process">
      <span class="pipeline-phase-number">2</span>
      <span class="pipeline-phase-title">Processing</span>
      <span class="pipeline-phase-tag">Sequential</span>
    </div>
    <div class="pipeline-phase-body">
      <div class="pipeline-steps">
        <div class="pipeline-step-row">
          <div class="pipeline-node pn-step">
            <span class="pn-icon">üìã</span>
            <span class="pn-label">Aggregate</span>
            <span class="pn-detail">Build per-pod resource maps</span>
          </div>
          <div class="pipeline-step-arrow">‚Üí</div>
          <div class="pipeline-node pn-step">
            <span class="pn-icon">üîã</span>
            <span class="pn-label">Estimate Energy</span>
            <span class="pn-detail">CPU √ó TDP ‚Üí Joules</span>
          </div>
          <div class="pipeline-step-arrow">‚Üí</div>
          <div class="pipeline-node pn-step">
            <span class="pn-icon">üó∫Ô∏è</span>
            <span class="pn-label">Map Zones</span>
            <span class="pn-detail">Region ‚Üí Carbon zone</span>
          </div>
        </div>
        <div class="pipeline-step-row">
          <div class="pipeline-node pn-step">
            <span class="pn-icon">üì°</span>
            <span class="pn-label">Fetch Intensity</span>
            <span class="pn-detail">Cache + API + fallback</span>
          </div>
          <div class="pipeline-step-arrow">‚Üí</div>
          <div class="pipeline-node pn-step">
            <span class="pn-icon">üåø</span>
            <span class="pn-label">Calculate CO‚ÇÇ</span>
            <span class="pn-detail">kWh √ó gCO‚ÇÇ/kWh √ó PUE</span>
          </div>
          <div class="pipeline-step-arrow">‚Üí</div>
          <div class="pipeline-node pn-step pn-highlight">
            <span class="pn-icon">üì¶</span>
            <span class="pn-label">Assemble</span>
            <span class="pn-detail">CombinedMetric per pod</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="pipeline-arrow-down">
    <svg width="24" height="32" viewBox="0 0 24 32">
      <line x1="12" y1="0" x2="12" y2="24" stroke="var(--sl-color-gray-4)" stroke-width="2"/>
      <polygon points="6,24 18,24 12,32" fill="var(--sl-color-accent)"/>
    </svg>
  </div>

  <!-- Phase 3 -->
  <div class="pipeline-phase">
    <div class="pipeline-phase-header phase-output">
      <span class="pipeline-phase-number">3</span>
      <span class="pipeline-phase-title">Output</span>
      <span class="pipeline-phase-tag">Async batch</span>
    </div>
    <div class="pipeline-phase-body">
      <div class="pipeline-nodes-grid pipeline-output-grid">
        <div class="pipeline-node pn-output">
          <span class="pn-icon">üóÑÔ∏è</span>
          <span class="pn-label">Database</span>
          <span class="pn-detail">Batch INSERT / COPY</span>
        </div>
        <div class="pipeline-node pn-output">
          <span class="pn-icon">üöÄ</span>
          <span class="pn-label">REST API</span>
          <span class="pn-detail">Real-time endpoints</span>
        </div>
        <div class="pipeline-node pn-output">
          <span class="pn-icon">üß†</span>
          <span class="pn-label">Recommender</span>
          <span class="pn-detail">Optimization analysis</span>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .pipeline-diagram {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
    margin: 2rem 0;
    font-family: system-ui, -apple-system, sans-serif;
  }

  .pipeline-phase {
    width: 100%;
    border: 1px solid var(--sl-color-gray-5);
    border-radius: 0.75rem;
    overflow: hidden;
    background: var(--sl-color-gray-6);
  }

  .pipeline-phase-header {
    display: flex;
    align-items: center;
    gap: 0.625rem;
    padding: 0.625rem 1rem;
    border-bottom: 1px solid var(--sl-color-gray-5);
  }

  .phase-collect { background: rgba(34, 197, 94, 0.08); }
  .phase-process { background: rgba(168, 85, 247, 0.08); }
  .phase-output { background: rgba(59, 130, 246, 0.08); }

  .pipeline-phase-number {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.5rem;
    height: 1.5rem;
    border-radius: 50%;
    background: var(--sl-color-accent);
    color: #fff;
    font-size: 0.75rem;
    font-weight: 700;
    flex-shrink: 0;
  }

  .pipeline-phase-title {
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--sl-color-white);
  }

  .pipeline-phase-tag {
    margin-left: auto;
    font-size: 0.65rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--sl-color-gray-3);
    background: var(--sl-color-gray-5);
    padding: 0.15rem 0.5rem;
    border-radius: 9999px;
  }

  .pipeline-phase-body {
    padding: 1rem;
  }

  .pipeline-nodes-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.625rem;
  }

  .pipeline-output-grid {
    grid-template-columns: repeat(3, 1fr);
  }

  .pipeline-node {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 0.75rem 0.5rem;
    border-radius: 0.5rem;
    border: 1px solid var(--sl-color-gray-5);
    transition: border-color 0.2s;
  }

  .pipeline-node:hover { border-color: var(--sl-color-accent); }

  .pn-source { background: rgba(34, 197, 94, 0.04); }
  .pn-step { background: rgba(168, 85, 247, 0.04); }
  .pn-highlight { background: rgba(245, 158, 11, 0.08); border-color: rgba(245, 158, 11, 0.3); }
  .pn-output { background: rgba(59, 130, 246, 0.04); }

  .pn-icon { font-size: 1.25rem; margin-bottom: 0.25rem; }
  .pn-label { font-size: 0.75rem; font-weight: 700; color: var(--sl-color-white); line-height: 1.2; }
  .pn-detail { font-size: 0.625rem; color: var(--sl-color-gray-3); margin-top: 0.15rem; line-height: 1.3; }

  .pipeline-arrow-down {
    display: flex;
    justify-content: center;
    padding: 0.125rem 0;
  }

  .pipeline-steps {
    display: flex;
    flex-direction: column;
    gap: 0.625rem;
  }

  .pipeline-step-row {
    display: grid;
    grid-template-columns: 1fr auto 1fr auto 1fr;
    align-items: center;
    gap: 0.375rem;
    justify-content: center;
  }

  .pipeline-step-row .pipeline-node {
    min-width: 0;
  }

  .pipeline-step-arrow {
    color: var(--sl-color-accent);
    font-weight: 700;
    font-size: 1rem;
    flex-shrink: 0;
  }

  @media (max-width: 768px) {
    .pipeline-nodes-grid {
      grid-template-columns: repeat(2, 1fr);
    }
    .pipeline-output-grid {
      grid-template-columns: repeat(2, 1fr);
    }
    .pipeline-step-row {
      grid-template-columns: 1fr;
    }
    .pipeline-step-arrow {
      display: none;
    }
  }
</style>
